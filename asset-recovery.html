<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Asset Recovery - Chesmi Groups IT</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<form class="a4-page" id="recoveryForm">
    <header>
        <div class="logo-container">
            <img src="chesmi-logo.png" alt="Chesmi Logo">
        </div>
        <h1>Employee Resignation - Company Property Return</h1>
    </header>

    <h2>Employee Information (To be completed upon separation)</h2>
    <div class="form-group">
        <label for="fullName">Full Name:</label>
        <div class="input-container"><input type="text" id="fullName" placeholder="E.g., Sahan De Silva" required></div>
    </div>
    <div class="form-group">
        <label for="employeeID">Employee ID:</label>
        <div class="input-container"><input type="text" id="employeeID" placeholder="E.g., CHS-12345" required></div>
    </div>
    <div class="form-group">
        <label for="company">Company:</label>
        <div class="input-container"><input type="text" id="company" placeholder="E.g., Chesmi Exports" required></div>
    </div>
    <div class="form-group">
        <label for="branch">Branch:</label>
        <div class="input-container"><input type="text" id="branch" placeholder="E.g., Colombo Main Branch" required></div>
    </div>
    <div class="form-group">
        <label for="designation">Designation:</label>
        <div class="input-container"><input type="text" id="designation" placeholder="E.g., Marketing Executive" required></div>
    </div>

    <h2>Related Assets (Hardware / Equipment)</h2>
    <table id="assetsTable">
        <thead>
            <tr>
                <th style="width: 35%;">Codename (e.g., Laptop, Monitor)</th>
                <th>Serial Number</th>
                <th class="no-print" style="width: 80px;">Action</th>
            </tr>
        </thead>
        <tbody id="assetsTableBody">
            </tbody>
    </table>
    <div style="text-align: right; margin-top: 10px;">
        <button type="button" class="no-print" onclick="addAssetRow()">+ Add Another Asset</button>
    </div>

    <h2>Related Peripherals & Accessories</h2>
    <table class="peripheral-table">
        <thead>
            <tr>
                <th style="width: 20%;">Peripheral</th>
                <th style="width: 100px; text-align: center;">Returned (âœ”)</th>
                <th>Remark / Condition / Serial Number</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Mouse (Standard)</td>
                <td style="text-align: center;"><input type="checkbox" name="peripheralMouse" value="Returned"></td>
                <td><input type="text" name="peripheralMouseRemark" placeholder="Enter condition or S/N if applicable"></td>
            </tr>
            <tr>
                <td>Headset / Earpiece</td>
                <td style="text-align: center;"><input type="checkbox" name="peripheralHeadset" value="Returned"></td>
                <td><input type="text" name="peripheralHeadsetRemark" placeholder="Enter condition or S/N if applicable"></td>
            </tr>
            <tr>
                <td>Keyboard (Standard)</td>
                <td style="text-align: center;"><input type="checkbox" name="peripheralKeyboard" value="Returned"></td>
                <td><input type="text" name="peripheralKeyboardRemark" placeholder="Enter condition or S/N if applicable"></td>
            </tr>
            <tr>
                <td>
                    <span style="font-weight: bold;">Other:</span> 
                    <div class="input-container" style="display: inline-block; width: 60%;"><input type="text" name="peripheralOther" placeholder="Specify item (e.g., Tablet, Data Card)"></div>
                </td>
                <td style="text-align: center;"><input type="checkbox" name="peripheralOtherCheck" value="Returned"></td>
                <td><input type="text" name="peripheralOtherRemark" placeholder="Enter condition or S/N if applicable"></td>
            </tr>
        </tbody>
    </table>

    <h2>Additional Notes</h2>
    <div class="form-group" style="display: block;">
        <textarea id="additionalNotes" rows="4" style="width: 100%;" placeholder="Document any missing items, outstanding issues, or important details regarding the asset return process."></textarea>
    </div>

    <div class="signature-block">
        <div class="signature-field">
            <div class="signature-line"></div>
            <p class="signature-label">Employee Signature (Confirming handover)</p>
        </div>
        <div class="signature-field">
            <div class="input-container"><input type="text" placeholder="Employee Name (Print)" id="employeeNameInput"></div>
            <p class="signature-label">Name</p>
        </div>
        <div class="signature-field">
            <div class="input-container"><input type="date" id="employeeDateInput"></div>
            <p class="signature-label">Date</p>
        </div>
    </div>
    
    <div class="signature-block">
        <div class="signature-field">
            <div class="signature-line"></div>
            <p class="signature-label">Authorized By IT Department Signature</p>
        </div>
        <div class="signature-field">
            <div class="input-container"><input type="text" placeholder="IT Staff Name (Print)" id="itNameInput"></div>
            <p class="signature-label">Name</p>
        </div>
        <div class="signature-field">
            <div class="input-container"><input type="date" id="itDateInput"></div>
            <p class="signature-label">Date</p>
        </div>
    </div>
</form>

<div class="form-actions no-print">
    <button type="button" onclick="generatePdf('Chesmi-Asset-Recovery.pdf')">ðŸ’¾ Download as PDF</button>
    <button type="button" class="email-btn" onclick="shareViaEmail('Asset Recovery Form')">ðŸ“§ Share via Email</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
    // --- PDF Generation and Email Functions ---
    async function generatePdf(fileName) {
        const { jsPDF } = window.jspdf;
        const formToCapture = document.querySelector('.a4-page');
        const actionButtons = document.querySelector('.form-actions');

        // Hide buttons before capture to keep the PDF clean
        actionButtons.style.display = 'none';

        const canvas = await html2canvas(formToCapture, {
            scale: 2, // Increase scale for better quality
            useCORS: true
        });

        // Show buttons again after capture
        actionButtons.style.display = 'block';

        const imgData = canvas.toDataURL('image/png');
        const pdf = new jsPDF('p', 'mm', 'a4');
        const pdfWidth = pdf.internal.pageSize.getWidth();
        const pdfHeight = pdf.internal.pageSize.getHeight();
        
        pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
        pdf.save(fileName);
    }

    function shareViaEmail(formType) {
        const employeeName = document.getElementById('fullName').value || 'Employee';
        const subject = `${formType} for ${employeeName}`;
        const body = `Dear Team,\n\nPlease find the ${formType} attached for your review.\n\nThis is a client-generated request. Please download the PDF from the form and attach it to this email before sending.\n\nThank you,\n${employeeName}`;
        
        // Use mailto to open the default email client
        window.location.href = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    }


    // --- Form Specific Functions ---
    document.addEventListener('DOMContentLoaded', () => {
        addAssetRow(); 
        addAssetRow();
    });

    function addAssetRow() {
        const tableBody = document.getElementById('assetsTableBody');
        const newRow = tableBody.insertRow();
        newRow.innerHTML = `
            <td><div class="input-container"><input type="text" name="codename" placeholder="e.g., Laptop, Monitor" required></div></td>
            <td><div class="input-container"><input type="text" name="serialNumber" placeholder="e.g., SN-12345678" required></div></td>
            <td class="no-print" style="text-align: center;"><button type="button" class="remove-asset-btn" onclick="removeAssetRow(this)">Remove</button></td>
        `;
    }

    function removeAssetRow(button) {
        const tableBody = document.getElementById('assetsTableBody');
        if (tableBody.rows.length > 1) {
            button.closest('tr').remove();
        } else {
            alert("You cannot remove the last asset row. At least one asset must be listed for clearance.");
        }
    }
</script>
</body>
</html>
